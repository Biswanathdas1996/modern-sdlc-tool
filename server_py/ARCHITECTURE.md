# Backend Architecture Diagram

## ğŸ—ï¸ Layered Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CLIENT (React/Vite)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ HTTP Requests
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  API LAYER (api/v1/)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Projects â”‚  â”‚   BRD    â”‚  â”‚  Tests   â”‚  â”‚Knowledge â”‚   â”‚
â”‚  â”‚  Router  â”‚  â”‚  Router  â”‚  â”‚  Router  â”‚  â”‚   Base   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â”‚
â”‚       â”‚             â”‚              â”‚             â”‚          â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                           â”‚                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ Delegates to
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               SERVICE LAYER (services/)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚    AI    â”‚  â”‚   JIRA   â”‚  â”‚Knowledge â”‚  â”‚  GitHub  â”‚   â”‚
â”‚  â”‚ Service  â”‚  â”‚ Service  â”‚  â”‚   Base   â”‚  â”‚ Service  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â”‚
â”‚       â”‚             â”‚              â”‚             â”‚          â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                           â”‚                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ Uses
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           REPOSITORY LAYER (repositories/)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Project  â”‚  â”‚   BRD    â”‚  â”‚  Test    â”‚  â”‚  Story   â”‚   â”‚
â”‚  â”‚   Repo   â”‚  â”‚   Repo   â”‚  â”‚   Repo   â”‚  â”‚   Repo   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â”‚
â”‚       â”‚             â”‚              â”‚             â”‚          â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                           â”‚                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ Persists to
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              DATA LAYER (core/database.py)                   â”‚
â”‚                                                              â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚    â”‚  In-Memory      â”‚          â”‚     MongoDB      â”‚       â”‚
â”‚    â”‚   Storage       â”‚          â”‚    (Knowledge    â”‚       â”‚
â”‚    â”‚  (Development)  â”‚          â”‚      Base)       â”‚       â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Request Flow Example

```
1. Client Request
   â”‚
   â”œâ”€â†’ POST /api/projects/analyze
   â”‚   { "repoUrl": "https://github.com/user/repo" }
   â”‚
2. API Router (api/v1/projects.py)
   â”‚
   â”œâ”€â†’ Validates request using Pydantic schema
   â”œâ”€â†’ Calls background task
   â”‚
3. Background Task
   â”‚
   â”œâ”€â†’ ai.analyze_repository()
   â”‚   â”‚
   â”‚   â”œâ”€â†’ GitHub Service fetches code
   â”‚   â”œâ”€â†’ AI Service analyzes code
   â”‚   â””â”€â†’ Returns analysis data
   â”‚
4. Repository Layer
   â”‚
   â”œâ”€â†’ storage.create_analysis(data)
   â”œâ”€â†’ storage.update_project(id, updates)
   â”‚
5. Response
   â”‚
   â””â”€â†’ Returns project with status "analyzing"
```

## ğŸ“¦ Module Dependencies

```
app.py
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ config.py (settings)
â”‚   â”œâ”€â”€ database.py (MongoDB)
â”‚   â””â”€â”€ logging.py (setup)
â”‚
â”œâ”€â”€ middleware/
â”‚   â””â”€â”€ logging.py (HTTP logging)
â”‚
â”œâ”€â”€ api/v1/
â”‚   â”œâ”€â”€ projects.py
â”‚   â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â””â”€â”€ services/
â”‚   â”‚
â”‚   â””â”€â”€ knowledge_base.py
â”‚       â”œâ”€â”€ schemas/
â”‚       â”œâ”€â”€ repositories/
â”‚       â””â”€â”€ services/
â”‚
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ ai_service.py
â”‚   â”‚   â”œâ”€â”€ core.config
â”‚   â”‚   â”œâ”€â”€ core.logging
â”‚   â”‚   â””â”€â”€ utils.text
â”‚   â”‚
â”‚   â”œâ”€â”€ jira_service.py
â”‚   â”‚   â”œâ”€â”€ core.config
â”‚   â”‚   â””â”€â”€ core.logging
â”‚   â”‚
â”‚   â””â”€â”€ knowledge_base_service.py
â”‚       â”œâ”€â”€ core.database
â”‚       â”œâ”€â”€ core.logging
â”‚       â””â”€â”€ utils.text
â”‚
â”œâ”€â”€ repositories/
â”‚   â”œâ”€â”€ base.py
â”‚   â”œâ”€â”€ project_repository.py
â”‚   â”‚   â””â”€â”€ base.py
â”‚   â”‚
â”‚   â””â”€â”€ storage.py
â”‚       â”œâ”€â”€ base.py
â”‚       â””â”€â”€ project_repository.py
â”‚
â”œâ”€â”€ schemas/
â”‚   â”œâ”€â”€ requests.py
â”‚   â””â”€â”€ entities.py
â”‚
â””â”€â”€ utils/
    â”œâ”€â”€ exceptions.py
    â”œâ”€â”€ response.py
    â””â”€â”€ text.py
```

## ğŸ¯ Separation of Concerns

| Layer | Responsibility | Example |
|-------|---------------|---------|
| **API** | HTTP handling, validation | Receive request, validate, return response |
| **Service** | Business logic, external APIs | Analyze repo, generate BRD, sync to JIRA |
| **Repository** | Data persistence | Save project, get analysis, update user story |
| **Schema** | Data structure, validation | Define request/response models |
| **Core** | Configuration, infrastructure | Settings, database, logging |
| **Utils** | Shared utilities | JSON parsing, text chunking, exceptions |

## ğŸ” Configuration Flow

```
Environment Variables (.env)
         â”‚
         â–¼
    core/config.py
    (Pydantic Settings)
         â”‚
         â”œâ”€â†’ app.py (FastAPI app)
         â”œâ”€â†’ services/ (AI, JIRA, etc.)
         â””â”€â†’ core/database.py (MongoDB)
```

## ğŸš€ Startup Sequence

```
1. Load .env file
   â†“
2. Initialize Settings (core.config)
   â†“
3. Setup Logging (core.logging)
   â†“
4. Create FastAPI app
   â†“
5. Add Middleware (CORS, Logging)
   â†“
6. Register Routers (api/v1/*)
   â†“
7. Connect to MongoDB (if configured)
   â†“
8. Start Uvicorn server
   â†“
9. Ready to accept requests! âœ…
```

## ğŸ“Š Data Flow

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Client App    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   API Router    â”‚
                    â”‚  (Validation)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                â”‚                â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
    â”‚  AI Service  â”‚  â”‚JIRA Service â”‚  â”‚KB Serviceâ”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
            â”‚                â”‚                â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Repository    â”‚
                    â”‚    (Storage)    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  In-Memory DB   â”‚     â”‚    MongoDB      â”‚
        â”‚  (Dev/Demo)     â”‚     â”‚  (Production)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¨ Design Patterns Used

1. **Repository Pattern**: Data access abstraction
2. **Service Layer Pattern**: Business logic separation
3. **Dependency Injection**: Loose coupling
4. **Factory Pattern**: Service creation
5. **Singleton Pattern**: Settings instance
6. **Strategy Pattern**: Different AI providers
7. **Middleware Pattern**: Request/response processing

## ğŸ§ª Testing Strategy

```
Unit Tests
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ test_ai_service.py
â”‚   â”œâ”€â”€ test_jira_service.py
â”‚   â””â”€â”€ test_kb_service.py
â”‚
Integration Tests
â”œâ”€â”€ api/v1/
â”‚   â”œâ”€â”€ test_projects.py
â”‚   â”œâ”€â”€ test_brd.py
â”‚   â””â”€â”€ test_knowledge_base.py
â”‚
End-to-End Tests
â””â”€â”€ test_workflows.py
    â”œâ”€â”€ test_analyze_and_generate_brd()
    â”œâ”€â”€ test_generate_user_stories()
    â””â”€â”€ test_sync_to_jira()
```
